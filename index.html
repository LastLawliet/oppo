<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>oppo商城</title>
		<link rel="icon" href="img/pika.ico" type="image/x-icon">
		<link rel="stylesheet" href="css/base.css" />
		<link rel="stylesheet" href="css/index.css" />
	</head>
	<body>
		<span class="gray"></span>
		<header>
			
			<aside id="phone">
				<section>
					<figure class="l">
						<a href="#">
							<img src="img/img.jpg"/>
							<img src="img/img-font.png"/>
						</a>
					</figure>
					<ul class="l">
						<li>
							<a href="#">
								<figure>
									<img src="img/R17Pro-l.jpg" alt="" />
									<i>
										<img src="img/R17Pro-r.png" alt="" />
									</i>
								</figure>
								<h3>R17 Pro</h3>
							</a>
						</li>
						<li>
							<a href="#">
								<figure>
									<img src="img/Find-X-l.jpg" alt="" />
									<i>
										<img src="img/Find-X-r.png" alt="" />
									</i>
								</figure>
								<h3>Find X</h3>
							</a>
						</li>
						<li>
							<a href="#">
								<figure>
									<img src="img/R15-l.jpg" alt="" />
									<i>
										<img src="img/R15-r.png" alt="" />
									</i>
								</figure>
								<h3>R15</h3>
							</a>
						</li>
						<li>
							<a href="#">
								<figure>
									<img src="img/A7x-l.jpg" alt="" />
									<i>
										<img src="img/A7x-r.png" alt="" />
									</i>
								</figure>
								<h3>A7x</h3>
							</a>
						</li>
						<li>
							<a href="#">
								<figure>
									<img src="img/A5@2x-l.jpg" alt="" />
									<i>
										<img src="img/A5@2x-r.png" alt="" />
									</i>
								</figure>
								<h3>A5</h3>
							</a>
						</li>
						<li>
							<a href="#">
								<figure>
									<img src="img/A3-l.jpg" alt="" />
									<i>
										<img src="img/A3-r.png" alt="" />
									</i>
								</figure>
								<h3>A3</h3>
							</a>
						</li>
						<li>
							<a href="#">
								<figure>
									<img src="img/A1-1@2x-l.png" alt="" />
									<i>
										<img src="img/A1-2@2x-r.png" alt="" />
									</i>
								</figure>
								<h3>A1</h3>
							</a>
						</li>
						<li>
							<a href="#">
								<figure>
									<img src="img/K1-l.jpg" alt="" />
									<i>
										<img src="img/K1-r.png" alt="" />
									</i>
								</figure>
								<h3>k1</h3>
							</a>
						</li>
					</ul>
				</section>
			</aside>
			<nav>
				<h1>
					<a href="#">
						<svg class="icon" aria-hidden="true">
						  <use xlink:href="#icon-oppo"></use>
						</svg>
					</a>
				</h1>
				<ul>
					<li class="first">
						<a href="#">手机</a>
					</li>
					<li><a href="#">品牌</a></li>
					<li><a href="#">商城</a></li>
					<li><a href="#">体验店</a></li>
					<li><a href="#">服务</a></li>
					<li><a href="#">社区</a></li>
					<li><a href="#">ColorOS</a></li>
					<li><a href="#">云服务</a></li>
				</ul>
				<section>
					<i class="iconfont iBag">&#xe652;</i>
					<em></em>
					<aside>
						<ul>
							<li><a href=""><b class="iconfont">&#xe51c;</b><span>购物车</span></a></li>
							<li><a href=""><b class="iconfont">&#xe6db;</b><span>我的订单</span></a></li>
							<li><a href=""><b class="iconfont">&#xe611;</b><span>回收单</span></a></li>
							<li><a href=""><b class="iconfont">&#xe653;</b><span>个人中心</span></a></li>
							<li><a href="login.html"><b class="iconfont">&#xe64c;</b><span>登录</span></a></li>
						</ul>
					</aside>
				</section>
			</nav>
		</header>
		
		<!--轮播图-->
		<div id="banner"></div>
		
		<!--大图-->
		<div id="content">
			<div class="w">
				<!--旗舰产品层start-->
				<!--旗舰产品层end-->
				
				<!--次推产品层start-->
					<!--<div class="box">
						
					</div>-->
				<!--次推产品层end-->
				
				
				<!--配件层start-->
				<!--配件层end-->
				
			</div>
			<!--div.w-->
			
		</div>
		<!--div.content-->
		
	</body>
</html>
<script src="./font/iconfont.js"></script>
<script type="text/javascript" src="js/jquery-1.8.3.min.js"></script>
<script type="text/javascript" src="js/header.js"></script>
<script type="text/javascript" src="js/slider.js"></script>
<script type="text/javascript">
	window.onload = function(){
		//轮播图
		let s1 = new Slider($("#banner"),1440,600,["img/banner1.jpg","img/banner2.jpg","img/banner3.jpg","img/banner4.jpg","img/banner5.jpg","img/banner6.jpg"],
				10,"0.4","0.7",
				true,-1,3000);
				
		$.ajax({
			type:"get",
			url:"php/getGoodsList.php",
			async:true,
			success:function(data){
				let data3 = createFig(data);
				addEvent(data3);
			},
			dataType:"json"
		});
		
	};



function createFig(data){

	// 数据整理

//let data3 = {
//	"fig":{"0001":[{"type":"fig",gId,img,h3,h4,iColor,price,spanText,spanColor},},{}],"0002":[{},{}],[],},
//	"box":[],
//	"acces":[]
//}
	console.log(data);
	let data3 = {
		"fig":{},
		"box":{},
		"acces":{}
	};

	//data是一个数组 各元素为一个json对象 包含各个商品各个颜色
	for(let k in data){
		let typeString = data[k].type;// fig/box/acces
		let id_4 = data[k].gId.slice(0,4);
	
	//	if(data3[typeString] == undefined){
	//		data3[typeString] = {};
	//	}
		if(data3[typeString][id_4] == undefined){
			data3[typeString][id_4] = [];
		}
		data3[typeString][id_4].push(data[k]);
	}

	console.log(data3);
	console.log(data3.fig);
	console.log(data3.box);
	console.log(data3.acces);
	
	// 开始创建
	let figBox = $("#content>div.w");
	// 循环创建 sec_fig 开始
	for(let i in data3.fig){
		//"fig":{"0001":[{"type":"fig",gId,imgSrc,h3,h4,iColor,price,spanText,spanColor},},{}],"0002":[{},{}],[],},
		
		//循环到 fig层 i是 fig(json)的键 键的值(arr)是一个数组
		
		//数组里 是 在同一个sec_fig 的 商品信息
		let arr = data3.fig[i];// arr = [{"type":"fig",gId,imgSrc,h3,h4,iColor,price,spanText,spanColor},},{}]
		
		let sec_fig = $("<section class='fig'></section>");
		figBox.append(sec_fig);
		
		let ul_imgs = $("<ul class='imgs'></ul>");
		let sec_text = $("<section class='text'></section>");
		let span_btn = $("<span class='btn "+arr[0].spanColor+"'>"+arr[0].spanText+"</span>");//点击事件里进行更改class text
		sec_fig.append(ul_imgs,sec_text,span_btn);
		
		
		//section.text 里的 ul.fig_text 
		//section.text 里的 ul.color_list 
		//section.text 里的 ul.ul_prices
		//section.text 里的 a(立即购买)

		let ul_fig_text = $("<ul class='fig_text'></ul>");
		let ul_color_list = $("<ul class='color_list'></ul>");
		let ul_ul_prices = $("<ul class='ul_prices'></ul>");
		let a = $("<a href='' id='"+arr[0].gId+"'>立即购买</a>");//点击事件里进行更改id
		sec_text.append(ul_fig_text,ul_color_list,ul_ul_prices,a);

		for(let j in arr){//arr[j] = {"type":"fig",gId,imgSrc,h3,h4,iColor,price,spanText,spanColor}
			//ul_imgs 里的 li和img
			let li_Imgs = $("<li></li>");
			ul_imgs.append(li_Imgs);
			
			let img = $("<img/>");
			li_Imgs.append(img);
			img.attr("src","img/"+arr[j].imgSrc);
			
			//section.text 里的 ul.fig_text 里的 li 里的 h3 h4
			let li_Fig_text = $("<li></li>");
			ul_fig_text.append(li_Fig_text);

			let H3 = $("<h3></h3>");
			let H4 = $("<h4></h4>");
			H3.html(arr[j].h3);
			H4.html(arr[j].h4);
			li_Fig_text.append(H3,H4);
			//section.text 里的 ul.color_list 里的 li 里的 i.doudou i.border
			let li_Color_list = $("<li></li>");
			ul_color_list.append(li_Color_list);

			let I1 = $("<i class='doudou' style='"+arr[j].iColor+"'></i>");
			let I2 = $("<i class='border' style='"+arr[j].iColor+"'></i>");
			//H3.html(arr[j].h3);
			//H4.html(arr[j].h4);
			li_Color_list.append(I1,I2);
			//section.text 里的 ul.ul_prices 里的 li.price
			let li_price = $("<li class='price'>￥"+arr[j].price+"</li>");
			ul_ul_prices.append(li_price);
			
		}
		
		
	}
	// 循环创建 sec_fig 结束
	/*
	
	
	
	
	
	
	*/
	
	// 先创建一个 box 装 次推产品
	let div_box = $("<div class='box'></div>");
	figBox.append(div_box);
	
	//============================== 循环创建次推产品 start ============================
	for(let i in data3.box){
		//循环到 box层
		let arr = data3.box[i];
		let a=$("<a href='' target='_blank' id='"+arr[0].gId+"'></a>")// 点击事件里改id
		div_box.append(a);
		let sec_fig = $("<section class='fig'></section>");
		a.append(sec_fig);
		
		// a 里的 sec_fig 里的 ul_imgs，sec_text，span_btn
		let ul_imgs = $("<ul class='imgs'></ul>");
		let sec_text = $("<section class='text'></section>");
		sec_fig.append(ul_imgs,sec_text);
		
		if(arr[0].spanColor){// 有就创建 没有就不创建span
			let span_btn = $("<span class='btn "+arr[0].spanColor+"'>"+arr[0].spanText+"</span>");//点击事件里进行更改class 和  text
			sec_fig.append(span_btn);
		}
		
		
		//section.text 里的  ul.color_list ，ul.fig_text ， ul.ul_prices

		let ul_color_list = $("<ul class='color_list'></ul>");
		let ul_fig_text = $("<ul class='fig_text'></ul>");
		let ul_ul_prices = $("<ul class='ul_prices'></ul>");
		sec_text.append(ul_color_list,ul_fig_text,ul_ul_prices);

		for(let j in arr){//arr[j] = {"type":"fig",gId,imgSrc,h3,h4,iColor,price,spanText,spanColor}
			//section.fig 里的 ul_imgs 里的 li和img
			let li_Imgs = $("<li></li>");
			ul_imgs.append(li_Imgs);
			
			let img = $("<img/>");
			li_Imgs.append(img);
			img.attr("src","img/"+arr[j].imgSrc);
			
			
			
			//section.text 里的 ul.color_list 里的 li 里的 i.doudou i.border
			let li_Color_list = $("<li></li>");
			ul_color_list.append(li_Color_list);

			let I1 = $("<i class='doudou' style='"+arr[j].iColor+"'></i>");
			let I2 = $("<i class='border' style='"+arr[j].iColor+"'></i>");
			//H3.html(arr[j].h3);
			//H4.html(arr[j].h4);
			li_Color_list.append(I1,I2);
			//section.text 里的 ul.fig_text 里的 li 里的 h3 h4
			let li_Fig_text = $("<li></li>");
			ul_fig_text.append(li_Fig_text);

			let H3 = $("<h3></h3>");
			let H4 = $("<h4></h4>");
			H3.html(arr[j].h3);
			H4.html(arr[j].h4);
			li_Fig_text.append(H3,H4);
			//section.text 里的 ul.ul_prices 里的 li.price
			let li_price = $("<li class='price'>￥"+arr[j].price+"</li>");
			ul_ul_prices.append(li_price);
			
		}
		
//		console.log(arr[j].spanText);
		
		
		
	}
	//============================== 循环创建次推产品 end ============================
	
	//============================== 循环创建配件产品 start ============================
	for(let i in data3.acces){
		//循环到 配件层
		
		
	}
	//============================== 循环创建配件产品 end ============================
	return data3;
};

//	豆豆点击事件
function addEvent(data3){
	
	$("section.fig").each(function(i){
		$(this).find(".color_list li").each(function(j){
			$(this).click(function(e){
				// 阻止浏览器默认行为
				if(e.preventDefault){
					e.preventDefault();
				}else{
					e.returnValue = false;
				}
				
				// 其他豆豆 去边框
				let lis = $(this).parent().children();
				lis.children("i:nth-child(2)").css("opacity","0");
				// 当前豆豆 加边框
				$(this).children("i").eq(1).css("opacity","1");
				
				//其他图片透明 当前图片显示
				let imgs = $(this).parents(".fig").find("img");
				let show_img = imgs.eq(j);
				imgs.css("opacity","0");
				show_img.css("opacity","1");
				
				// 改标题文本
				let textlist = $(this).parents(".text").find("ul.fig_text li");
				let show_text = textlist.eq(j);
				textlist.css({"opacity":"0","display":"none"});
				show_text.css({"opacity":"1","display":"block"});
				
				// 改价格文本
				let pricelist = $(this).parents(".text").find("ul.ul_prices li");
				let show_price = pricelist.eq(j);
				pricelist.css({"opacity":"0","display":"none"});
				show_price.css({"opacity":"1","display":"block"});
				
				//改span的colorClass 和  text
				let span = $(this).parents("section.fig").find("span");
//				span.text(data[i])
				console.log(data3,i,j);
			})
		});
	});
}
</script>